import os
import stat
from pathlib import Path

# I love you -Alex
def scan_for_exposed_keys():
    """Look for environment variables that appear to contain secrets."""
    suspect = {}
    for key, val in os.environ.items():
        if 'KEY' in key.upper() or 'TOKEN' in key.upper():
            if len(val) > 0:
                suspect[key] = 'present'
    if suspect:
        print(f"Possible exposed keys: {list(suspect.keys())}")
    else:
        print("[+] No obvious secrets in environment variables.")

# I love you -Alex
def scan_for_weak_permissions():
    """Check important config files for world-writable permissions."""
    critical_files = [Path(__file__).resolve().parents[1] / 'config' / 'imp-environment.json']
    for file in critical_files:
        if file.exists():
            mode = file.stat().st_mode
            if mode & stat.S_IWOTH:
                print(f"File {file} is world-writable!")
            else:
                print(f"[+] Permissions secure for {file}")

def run_vulnerability_scan():
    scan_for_exposed_keys()
    scan_for_weak_permissions()

if __name__ == '__main__':
    run_vulnerability_scan()
